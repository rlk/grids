<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="user-guide.css" />
  <link rel="stylesheet" type="text/css" href="../grid.css" />
  <script type="module" src="../grid.js"></script>
  <title>Gridgen User Guide</title>
</head>

<body>
  <h1>Gridgen User Guide</h1>
  <p>Gridgen is a visual calculator for guitar chords. It's capable of manipulating chords, infering chord symbols, rendering chord grids to SVGs, and embedding SVGs in HTML documents. Here's an example output:</p>
  <p class="center">
    <span class="gridgen">
      C 1 cho 6 8 1 + 5 10 5 + 3 9 3 + 2 12 7 x
      C 4 cho 5 8 1 + 4 10 5 + 3 9 7 x 2 10 3 +
      over d- over d- over d- over d- over d- over d- am span
    </span>
  </p>
  <p>Gridgen content appears within HTML span or td elements with &ldquo;gridgen&rdquo; class. Each element's innerHTML is interpreted as a chord calculation expression, the result of which replaces that element in the document.</p>
  <p>These chord manipulations and diagrams are based on the works of Ted Green.</p>
  <ul>
    <li id="cc">Greene, Ted. <i>Chord Chemistry.</i> Alfred Music Publishing, 1971.</li>
    <li id="mcp">Greene, Ted. <i>Modern Chord Progressions.</i> Vol. 1. Alfred Music Publishing, 1976.</li>
  </ul>

  <h2>Representation</h2>
  <p>Each Chord has a specified <em>key</em> and <em>degree</em> within that key. For example a G chord might have degree 1 in the key of G, degree 4 in the key of D, or degree 5 in the key of C. Specifying this ensures that manipulations on that chord are performed diatonically within its key.</p>
  <p>Similarly, each Stop has a specified interval within its chord. For example, a stop on 4th string at the 2nd fret would be an E, so its interval in a C chord would be 3. This is to ensure that chord symbols can be correctly inferred, even after chord manipulation. A C chord that marks an E‚ô≠ with an interval of 3 would be noted <span class="chord">Cmi</span>. (If it's unclear why this is necessary, note the ambiguous example of an A stop in a C chord, which might have an interval of either 6 or 7, denoting either a 6 chord or a ùÑ´7 chord.)</p>

  <h2>Operations</h2>
  <h3>Introduction</h3>
  <p>Here's a minimal example to get started. The expression <code>F 4 cho 4 8 1 + 3 7 3 + 2 6 5 + span</code> produces <span class="gridgen">F 4 cho 4 8 1 + 3 7 3 + 2 6 5 + span</span></p>
  <p>This is a <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">postfix</a> expression. Its evaluation uses a stack. It proceeds as follows:</p>
  <ul>
    <li><code>F 4 cho</code> is a <a href="#chord-constructor">chord constructor</a>.
      <ul>
        <li>The <code>F</code> and <code>4</code> are pushed onto the stack.</li>
        <li>The <code>cho</code> operator pops those operands and pushes a new chord with degree 4 in the key of F.</li>
      </ul>
    </li>
    <li><code>4 8 1 +</code> is a <a href="#dot-stop">dot stop</a>.
      <ul>
        <li>The <code>4</code>, <code>8</code>, and <code>1</code> are pushed onto the stack. They represent the string, fret, and interval.</li>
        <li>The <code>+</code> operator pops the three operands from the stack, along with the chord remaining on the stack from the previous step. It adds a new stop to the chord, and pushes the resulting chord back onto the top of the stack.</li>
      </ul>
    </li>
    <li><code>3 7 3 +</code> is another dot stop operation, leaving a chord with two stops on the stack.
    <li><code>2 6 5 +</code> is another dot stop operation, leaving a chord with three stops on the stack.
    <li><code>span</code> pops the chord from the stack, creates an HTML <a href="#span-element">span element</a> to represent it, and pushes the element onto the stack.</li>
  </ul>
  <p>At the end of all of this, only an HTML element remains on the stack. It is inserted into the document.</p>

  <h3 id="chord-constructor">Chord constructor</h3>
  <dl>
    <dt><i>&lt;key&gt;</i> <i>&lt;degree&gt;</i> <code>cho</code></dt>
    <dd>Create a new chord and push it onto the stack. <i>&lt;Key&gt;</i> is a symbol like <code>C</code> or <code>B‚ô≠</code> and <i>&lt;degree&gt;</i> is the chord degree in the range 1 to 7. This is the fundamental constructor of Gridgen chords and all other operators operate on these.</dd>
  </dl>

  <h3>Chord attribute operators</h3>
  <p>These operators add attributes to chords. The most important of these attributes are the stops that define the notes of the chord. Greene notation uses five distinct symbols, the dot, X, square and diamond, to be played in that order. An open circle is an optional stop. (<a href="#cc">CC</a> p.?)</p>
  <p>The stop appears at the given <i>&lt;string&gt;</i> and <i>&lt;fret&gt;</i>. The stop's voice within the chord has <i>&lt;interval&gt;</i> in the range 1 to 7. These values are popped from the stack, and the <i>&lt;chord&gt;</i> operand is pushed back onto the stack after the attribute is set.</p>
  <dl>
    <dt id="dot-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>+</code></dt>
    <dd>Add a dot stop to a chord.</dd>
    <dt id="x-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>x</code></dt>
    <dd>Add an X stop to a chord.</dd>
    <dt id="square-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>=</code></dt>
    <dd>Add a square stop to a chord.</dd>
    <dt id="diamond-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>^</code></dt>
    <dd>Add a diamond stop to a chord.</dd>
    <dt id="circle-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>o</code></dt>
    <dd>Add a circle stop to a chord.</dd>
    <dt id="blank-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>_</code></dt>
    <dd>Add a blank stop to a chord. A blank stop does not appear on the grid, but it can be used to influence <a href="#chord-alignment-operators">alignment operations</a> and chord symbol inference. (For example, if a chord voicing omits the root, then the symbol inference will likely fail for lack of information. Adding a root using a blank stop informs the inference without altering the appearance.)</dd>
    <dt id="decor-stop"><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <code>(+)</code> or <code>(x)</code> or <code>(=)</code> or <code>(^)</code> or <code>(o)</code> or <code>(_)</code></dt>
    <dd>Add a &ldquo;decoration&rdquo; stop to a chord. Decoration stops appear exactly like their counterparts above, but they do not contribute to the chord symbol. They may be used to notate a melody or bass line without altering the tune's basic changes.</dd>
    <dt><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;fret&gt;</i> <i>&lt;interval&gt;</i> <i>&lt;label&gt;</i> <code>.</code></dt>
    <dd>Add a stop with an arbitrary label to a chord. See <a href="#arbitrary-stop-labels">Arbitrary stop labels</a> for examples.</dd>
    <dt><i>&lt;chord&gt;</i> <i>&lt;text&gt;</i> <code>!</code></dt>
    <dd>Add a small text appearing beneath a chord. This can be used to annotate a chord with a description or performance notes. See <a href="#noting-time">Noting time</a> for examples.</dd>
    <dt><i>&lt;chord&gt;</i> <i>&lt;string&gt;</i> <i>&lt;finger&gt;</i> <code>#</code></dt>
    <dd>Add a finger number at the bottom of a chord. There is at most one number shown per <i>&lt;string&gt;</i>. <i>&lt;Finger&gt;</i> is a number between 1 and 4.</dd>
  </dl>

  <h3>Chord manipulation operators</h3>
  <p>The following operations replace the chord at the top of a stack with the result of a calculation based on that chord.</p>
  <dl>
    <dt><i>&lt;chord&gt;</i> <code>s+</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the chord on the next higher set of strings (higher in number, not in pitch). The chord is moved up 5 frets. (<a href="#mcp">MCP</a> p.18)</dd>
    <dt><i>&lt;chord&gt;</i> <code>s-</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the chord on the next lower set of strings. The chord is moved down 5 frets. (<a href="#mcp">MCP</a> p.19)</dd>
    <dt><i>&lt;chord&gt;</i> <code>d+</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the next higher chord in the diatonic chord scale, e.g. <span class="chord">Cma<sup>7</sup></span> becomes <span class="chord">Dmi<sup>7</sup></span>. (<a href="#mcp">MCP</a> p.17)</dd>
    <dt><i>&lt;chord&gt;</i> <code>d-</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the next lower chord in the diatonic chord scale, e.g. <span class="chord">Cma<sup>7</sup></span> becomes <span class="chord">Bmi<sup>7‚ô≠5</sup></span>. (<a href="#mcp">MCP</a> p.17)</dd>
    <dt><i>&lt;chord&gt;</i> <code>i+</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the next higher chord in the systematic inversion. (<a href="#cc">CC</a> p.?)</dd>
    <dt><i>&lt;chord&gt;</i> <code>i-</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the next lower chord in the systematic inversion. (<a href="#cc">CC</a> p.?)</dd>
    <dt><i>&lt;chord&gt;</i> <code>4+</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the chord a fourth higher, on the next lower set of strings. <span class="chord">Cma<sup>7</sup></span> rooted on 5 becomes <span class="chord">Fma<sup>7</sup></span> rooted on 4.</dd>
    <dt><i>&lt;chord&gt;</i> <code>5-</code></dt>
    <dd>Replace <i>&lt;chord&gt;</i> with the chord a fifth lower, on the next higher set of strings. <span class="chord">Cma<sup>7</sup></span> rooted on 5 becomes <span class="chord">G<sup>7</sup></span> rooted on 6.</dd>
  </dl>
  <p>It's possible for these operations to produce an &ldquo;invalid&rdquo; chord‚Äîa chord that uses negative fret numbers or non-existant strings. Such invalid chords are well-defined, and useful as temporary values. However, if they are displayed, they might appear impossible.

  <h3 id="chord-alignment-operators">Chord alignment operators</h3>
  <p>Chord alignment operators take a sequence of chords, equalize their size, and align them visually.</p>
  <dl>
    <dt><i>&lt;&middot; &middot; &middot;&gt;</i> <code>af</code></dt>
    <dd>Align all of the chords on the stack by fret. Specifically, set the bounds of each grid to the same value across all chords. Stretch the grid to accommodate a wide range.</dd>
    <dt><i>&lt;&middot; &middot; &middot;&gt;</i> <code>am</code></dt>
    <dd>Align all of the chords on the stack by mark. Specifically, set the bounds of each grid such that the marked fret (usually the root) lies in the same position in all chords.</dd>
  </dl>
  <p>This is almost always desirable, as each unaligned grid is displayed with minimal size. As a group, they will appear visually inconsistent.</p>

  <h3>Notation constructors</h3>
  <dl>
    <dt><code>|:</code></dt>
    <dd>Push a left repeat sign.</dd>
    <dt><code>|</code></dt>
    <dd>Push a bar marker.</dd>
    <dt><code>:|</code></dt>
    <dd>Push a right repeat sign.</dd>
    <dt><code>spc</code></dt>
    <dd>Push a blank space. This is particularly useful when laying out tables.</dd>
  </dl>

  <h3>HTML element constructors</h3>
  <p>HTML element constructors replace each item on the stack with an HTML element with class &ldquo;grid&rdquo;. On completion, this list of elements replaces the &ldquo;gridgen&rdquo; element whose innerHTML expression generated it.</p>
  <dl>
    <dt id="td-element"><i>&lt;&middot; &middot; &middot;&gt;</i> <code>td</code></dt>
    <dd>Replace each chord on the stack with a td element.</dd>
    <dt id="span-element"><i>&lt;&middot; &middot; &middot;&gt;</i> <code>span</code></dt>
    <dd>Replace each chord on the stack with a span element.</dd>
  </dl>

  <h3>General stack operators</h3>
  <dl>
    <dt id="drop"><i>&lt;A&gt;</i> <code>drop</code></dt>
    <dd>Pop the top element from the stack.</dd>
    <dt id="dupe"><i>&lt;A&gt;</i> <code>dupe</code></dt>
    <dd>Duplicate the top element on the stack. The stack will contain <i>&lt;A&gt;</i> <i>&lt;A&gt;</i>.</dd>
    <dt id="swap"><i>&lt;A&gt;</i> <i>&lt;B&gt;</i> <code>swap</code></dt>
    <dd>Swap the top two elements on the stack. The stack will contain <i>&lt;B&gt;</i> <i>&lt;A&gt;</i>.</dd>
    <dt id="over"><i>&lt;A&gt;</i> <i>&lt;B&gt;</i> <code>over</code></dt>
    <dd>Duplicate the second element to the top of the stack. The stack will contain <i>&lt;A&gt;</i> <i>&lt;B&gt;</i> <i>&lt;A&gt;</i>.</dd>
  </dl>

  <h2>Samples</h2>
  <p>The following is a list of gridgen examples. To see how each is defined, examine the HTML source of this document.</p>

  <h3 id="arbitrary-stop-labels">Arbitrary Stop Labels</h3>
  <p>The <code>.</code> operater adds a stop with an arbitrary character label. This has countless uses. For example, it may be used to indicate the fingering of a scale. This being the web, all of Unicode is at your disposal here.</p>
  <p class="center" style="zoom:150%">
    <span class="gridgen">
      D 1 cho
      6 2 3 1 . 6 3 4 2 . 6 5 5 4 .
      5 2 6 1 . 5 4 7 3 . 5 5 1 4 .
      4 2 2 1 . 4 4 3 3 . 4 5 4 4 .
      3 2 5 1 . 3 4 6 3 . 2 2 7 1 .
      2 3 1 2 . 2 5 2 4 .
      1 2 3 1 . 1 3 4 2 . 1 5 5 4 .
      span
    </span>
    <span class="gridgen debug">
      D 1 cho
      6 2 3 üçè . 6 3 4 üçé . 6 5 5 üçä .
      5 2 6 üçã . 5 4 7 üçã‚Äçüü© . 5 5 1 üçå .
      4 2 2 üçâ . 4 4 3 üçá . 4 5 4 üçì .
      3 2 5 ü´ê . 3 4 6 üçà . 2 2 7 üçí .
      2 3 1 üçë . 2 5 2 ü•≠ .
      1 2 3 üçç . 1 3 4 ü•• . 1 5 5 ü•ù .
      span
    </span>
  </p>

  <h3 id="noting-time">Noting time</h3>
  <p>Slashes and bars.</p>

  <h3>Overlaying Stops</h3>
  <p>Overlayed stops appear when an elaboration or a melody reuse a chord tone. For example, here's the melody and accompanyment to the lyric &ldquo;You say tomato, I say tomahto,&rdquo;</p>
  <p class="center">
    <span class="gridgen">
      G 1 cho 6 3 1 + 4 5 1 + 3 4 3 + 2 5 6 + 1 3 1 + 2 5 6 x 6 1 # 4 3 # 3 2 # 2 4 # 1 1 #
      G 6 cho 5 7 1 + 4 5 3 + 3 7 7 + 2 7 2 + 2 7 2 x 2 5 1 = 5 2 # 4 1 # 3 3 # 2 4 #
      G 2 cho 6 5 1 + 4 5 7 + 3 5 3 + 2 8 7 + 1 5 1 x 6 1 # 4 1 # 3 1 # 2 4 # 1 1 #
      G 5 cho 5 5 1 + 4 7 5 + 3 5 7 + 2 7 3 + 1 7 6 + 1 7 6 x 5 1 # 4 2 # 3 1 # 2 3 # 1 4 #
      af span
    </span>
  </p>
  <p>Order sometimes matters. Stops are displayed in the order they are added to a chord. Later stops are displayed topmost. Here's a grid showing each of the standard markers‚Äîdot, circle, X, square, and diamond‚Äîoverlaid with each other standard marker. It should be clear that dot and X should appear on top, while square, diamond, and circle must appear on the bottom.</code></p>
  <p class="center" style="zoom:150%">
    <span class="gridgen">
      C 1 cho
      5 3 1 + 4 3 1 o 3 3 1 x 2 3 1 = 1 3 1 ^

      5 4 1 + 4 4 1 o 3 4 1 x 2 4 1 = 1 4 1 ^
      6 4 1 + 5 4 1 + 4 4 1 + 3 4 1 + 2 4 1 + 1 4 1 +
      5 5 1 + 4 5 1 o 3 5 1 x 2 5 1 = 1 5 1 ^
      6 5 1 o 5 5 1 o 4 5 1 o 3 5 1 o 2 5 1 o 1 5 1 o
      5 6 1 + 4 6 1 o 3 6 1 x 2 6 1 = 1 6 1 ^
      6 6 1 x 5 6 1 x 4 6 1 x 3 6 1 x 2 6 1 x 1 6 1 x
      5 7 1 + 4 7 1 o 3 7 1 x 2 7 1 = 1 7 1 ^
      6 7 1 = 5 7 1 = 4 7 1 = 3 7 1 = 2 7 1 = 1 7 1 =
      5 8 1 + 4 8 1 o 3 8 1 x 2 8 1 = 1 8 1 ^
      6 8 1 ^ 5 8 1 ^ 4 8 1 ^ 3 8 1 ^ 2 8 1 ^ 1 8 1 ^
      span
    </span>
  </p>

  <h3>Size</h3>
  <p>To produce larger or smaller grids, set the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/zoom">zoom</a> CSS property on the container of the element with gridgen class.</p>
  <p class="center" style="zoom:150%">
    <span class="gridgen">
      C 1 cho 5 3 1 + 4 2 3 + 3 4 7 + 2 3 2 + dupe d+ dupe d+ dupe d+ dupe d+ dupe d+ dupe d+ dupe d+ am span
    </span>
  </p>

  <h3>Stop styling</h3>

  <h3>Forms for diatonic chord scales</h3>
  <p>(<a href="#mcp">MCP</a>, p. 23) introduces several forms for diatonic chord scales, and suggests the reader build diatonic chords from each of them. We can easily generate these chords just by specifying the initial form and extending the sequence.</p>

  <h3>The diatonic cycle of 4ths</h3>
  <p>(<a href="#mcp">MCP</a>, p. 49) discusses &ldquo;The Diatonic Cycle of 4ths in Major Keys.&rdquo; The first example there is straightforwardly reproduced by defining only the first two chords, <span class="chord">Cma<sup>7</sup></span> and <span class="chord">Fma<sup>7</sup></span>. Subsequent chords are each generated by an <code>over d-</code> operation. Specifically, the initial two chords on the stack are separated by a fourth. Then, <code>over</code> duplicates the <em>second</em> element from the top of the stack, and <code>d-</code> moves that duplicate down one degree.</p>
  <p class="center">
    <span class="gridgen">
      C 1 cho 6 8 1 + 5 10 5 + 3 9 3 + 2 12 7 x
      C 4 cho 5 8 1 + 4 10 5 + 3 9 7 x 2 10 3 +
      over d- over d- over d- over d- over d- over d- over d- over d- am span
    </span>
  </p>
  <p>Note how the elaboration established by the initial two chords is maintained in generated chords.</p>

  <h3>Structured inversion</h3>

  <h3>Tweaking the chord symbol</h3>
  <!-- decor stops -->
  <!-- spaces -->
  <!-- removing the chord symbol -->
  <!-- hard-coding the chord symbol -->

  <h3>Console debug logging</h3>
</body>

</html>